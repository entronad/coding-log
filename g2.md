# G2

G2 更新数据的方式主要有三种：

- 仅仅是更新图表的数据

  更新数据加刷新用 changeData，更新数据和刷新分离用 source 加 repaint

  chart.changeData(data) 方法 **只支持具备相同数据结构的数据** 进行更新

- 清理所有，重新绘制

  清除用clear 绘制用render

- 使用 DataView 时的更新

---

DataSet是一个独立的库

---

度量scale指将数据映射到[0, 1]区间，它在数据空间到图形空间的转换中十分重要

---

在 G2 中我们按照数值是否连续对数据进行分类：

1. 分类（非连续）数据，又分为有序分类和无序分类；
2. 连续数据，时间也是一种连续数据类型。

根据上述的数据分类方式，G2 提供了不同的度量类型：

| 数据类型       | 度量类型               |
| -------------- | ---------------------- |
| 连续           | linear、log、pow、time |
| 分类（非连续） | cat、timeCat           |

---

目前G2中所有坐标系（coord)都是2维的

---

事件为全小写，图形元素事件以"类别-元素名称:事件"的形式组合

---

G2 的图表可以由多个视图 View 构成，同时各个视图可以拥有各自的数据源，即支持异构数据。在结构上，视图和 chart 相同，拥有自己独立的数据源、坐标系和图层。

Chart 是一种特殊的View，两者之间也有一定的差异：

- View 的功能 Chart 都具有
- Tooltip（提示信息）和 Legend（图例）仅在 Chart 上支持
- Chart 上可以创建 View ，但是 View 不再支持创建子 View

---

数据处理流程：https://www.yuque.com/antv/g2-docs/tutorial-data-flow

---

G2的三个核心库：底层渲染g 

---

google/charts

How to draw a pie

---

在charts_flutter中，PieChart继承自BaseChart，其重写了两个函数：

createCommonChart，通过state返回common.PieChart，其主体是调用了common.PieChart的构造函数

addDefaultInteractions，通过behaviors挂载交互事件

---

**charts_flutter**

BaseChart继承自StatefulWidget，其build函数主要是返回一个ChartContainer。其state为独立的BaseChartState，BaseChart的方法可传入state参数，调用state的方法以便控制state，而通过此参数联系BaseChart和BaseChartState则是通过返回的ChartContainer的chartWidget成员和chartState成员

ChartContainer继承自CustomPaint，其Painter为继承自CustomPainter的ChartContainerCustomPaint，其paint函数由common.BaseChart chart参数提供，paint函数中的canvas为新建的ChartCanvas，它继承自common.ChartCanvas

理解重要的对象：CustomPaint，CustomPainter，Paint，Canvas，先实现一个完全没有事件和动画的

BaseChartState的build方法使用了CustomMultiChildLayout，其子元素需包裹在LayoutId中

ChartContainer继承自CustomPaint，重写createRenderObject，和updateRenderObject方法，其操作对象都是RenderCustomPaint，ChartContainer本身只用来记录cfg，核心逻辑写在继承自RenderCustomPaint的ChartContainerRenderObject中

它的painter称为ChartContainerCustomPaint（反了？)

一个图表上多个Series是通过customSeriesRenderers参数传入的列表设置的

BaseChart等传递的泛型D指的是Datum的domain类型



数据对象的类称为Series，其泛型第一个为用户定义的数据整体的类型，第二个泛型为数据值的类型

需指定如何从数据项获取x的domainFn和如何从数据项获取y的



**charts_common**

ChartContext指保存rtl、dpd, tappable等状态的上下文

LayoutConfig 设置margin

LayoutViewConfig 包括paintorder, position等信息，position是指明top、fullTop等的枚举

SeriesRenderer继承自LayoutView

ChartCanvas中是一堆drawXX方法，各种图形定义在canvas_shape中

SeriesRendererConfig中最主要的是rendererAttributes，它继承自TypedRegistry（主要提供getAttr，setAttr，mergeFrom方法），

datum 是data的单数形式



**f2**

数组系列util：

vector2：二维数组及其运算

BBox： 由xy轴的最大最小值确定的长方形区域，会考虑边界处的线宽，

Matrix：六维数组及其运算，action指明变换类型



图形引擎graphic中的基本类：

Element: 

提供attr的get/set/mix，这里的attr不是geom的attr，主要是是html canvas的attr，zIndex, visible, destroyed; 

为canvas提供draw方法；

提供hide/remove/destroy等方法；

提供一些parent/child操作；

提供一个6元素数组matrix，它表示一个二维数组到另一个二维数组的线性变换（2^2+2)，及其transform系列方法，transform的依据为action



Shape:

isShape为true，

drawInner提供绘制canvas的调用，具体图形由createPath方法确定

字段bbox 有minX,minY,maxX,maxY确定区域，x,y表示当前点（初始在min），width,height，left等计算得到

Canvas：

实际的东西由其字段el（html canvas),context, canvas(本身）确定

提供PixelRatio的转换，

提供一些周期钩子方法

Group:

isGroup为true

将相关操作应用到每一个child上，以及计算总bbox等







---

g2、f2区别：

api

2.没有dataSet

3.scale没有log、pow、多了identity

4.geom没有edge和heatmap

5.attr没有opacity

6.坐标系没有theta和helix

行数

f2:11766

g2:17566

g:7727

zrender:18008

echarts:67166